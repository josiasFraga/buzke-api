COPIAR OS NOVOS VALORES DE .ENV

UPDATE clientes_servicos_horarios AS csh
JOIN clientes_servicos AS cs ON csh.cliente_servico_id = cs.id
SET csh.valor_fixos = cs.valor, csh.valor_padrao = cs.valor;

UPDATE clientes_servicos_horarios SET clientes_servicos_horarios.fixos_tipo = 'Semanal'

UPDATE agendamentos a
JOIN clientes_servicos_horarios h 
ON a.servico_id = h.cliente_servico_id
   AND a.dia_semana = h.dia_semana
SET a.valor = h.valor_fixos
WHERE (a.dia_semana IS NOT NULL OR a.dia_mes IS NOT NULL)
  AND a.servico_id = h.cliente_servico_id;


UPDATE agendamentos a
JOIN clientes_servicos_horarios h 
ON a.servico_id = h.cliente_servico_id
SET a.valor = h.valor_padrao
WHERE a.dia_semana IS NULL 
  AND a.dia_mes IS NULL
  AND a.servico_id = h.cliente_servico_id;

CREATE TABLE IF NOT EXISTS `promocao_cliques` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created` timestamp NULL DEFAULT NULL,
  `token_id` int DEFAULT NULL,
  `promocao_id` int NOT NULL,
  `servico_id` int NOT NULL,
  PRIMARY KEY (`id`),
  KEY `FK_promocao_cliques_tokens` (`token_id`),
  KEY `FK_promocao_cliques_promocoes` (`promocao_id`),
  KEY `FK_promocao_cliques_clientes_servicos` (`servico_id`),
  CONSTRAINT `FK_promocao_cliques_clientes_servicos` FOREIGN KEY (`servico_id`) REFERENCES `clientes_servicos` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_promocao_cliques_promocoes` FOREIGN KEY (`promocao_id`) REFERENCES `promocoes` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_promocao_cliques_tokens` FOREIGN KEY (`token_id`) REFERENCES `tokens` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=113 DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `promocao_dias_semana` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created` timestamp NULL DEFAULT NULL,
  `updated` timestamp NULL DEFAULT NULL,
  `promocao_id` int NOT NULL,
  `dia_semana` tinyint NOT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  KEY `FK_promocao_servicos_promocoes` (`promocao_id`) USING BTREE,
  KEY `dia_semana` (`dia_semana`),
  CONSTRAINT `promocao_dias_semana_ibfk_2` FOREIGN KEY (`promocao_id`) REFERENCES `promocoes` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=96 DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC;

CREATE TABLE IF NOT EXISTS `promocao_servicos` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created` timestamp NULL DEFAULT NULL,
  `updated` timestamp NULL DEFAULT NULL,
  `promocao_id` int NOT NULL,
  `servico_id` int NOT NULL,
  PRIMARY KEY (`id`),
  KEY `FK_promocao_servicos_promocoes` (`promocao_id`),
  KEY `FK_promocao_servicos_clientes_servicos` (`servico_id`),
  CONSTRAINT `FK_promocao_servicos_clientes_servicos` FOREIGN KEY (`servico_id`) REFERENCES `clientes_servicos` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_promocao_servicos_promocoes` FOREIGN KEY (`promocao_id`) REFERENCES `promocoes` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=23 DEFAULT CHARSET=latin1;


CREATE TABLE IF NOT EXISTS `promocoes` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created` timestamp NULL DEFAULT NULL,
  `updated` timestamp NULL DEFAULT NULL,
  `cliente_id` int NOT NULL,
  `titulo` varchar(150) NOT NULL,
  `descricao` text NOT NULL,
  `validade_ate_cancelar` enum('Y','N') NOT NULL DEFAULT 'N',
  `validade_inicio` timestamp NULL DEFAULT NULL,
  `validade_fim` timestamp NULL DEFAULT NULL,
  `horario_inicio` time DEFAULT NULL,
  `horario_fim` time DEFAULT NULL,
  `promocao_para_fixos` enum('Y','N') CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL DEFAULT 'N',
  `promocao_para_padrao` enum('Y','N') NOT NULL DEFAULT 'N',
  `valor_padrao` float(9,2) DEFAULT NULL,
  `valor_fixos` float(9,2) DEFAULT NULL,
  `limite_ate` tinyint DEFAULT NULL,
  `finalizada` enum('Y','N') NOT NULL DEFAULT 'N',
  PRIMARY KEY (`id`),
  KEY `FK_promocoes_clientes` (`cliente_id`),
  KEY `finalizada` (`finalizada`),
  KEY `validade_inicio` (`validade_inicio`),
  KEY `validade_fim` (`validade_fim`),
  CONSTRAINT `FK_promocoes_clientes` FOREIGN KEY (`cliente_id`) REFERENCES `clientes` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=19 DEFAULT CHARSET=latin1;


CREATE TABLE IF NOT EXISTS `notificacoes_configuracoes_usuario` (
  `id` int NOT NULL AUTO_INCREMENT,
  `usuario_id` int NOT NULL,
  `receber_promocoes` tinyint(1) NOT NULL DEFAULT '1',
  `receber_avisos_novos_agendamentos` tinyint(1) NOT NULL DEFAULT '1',
  `receber_lembretes` tinyint(1) NOT NULL DEFAULT '1',
  `receber_avisos_cancelamentos` tinyint(1) NOT NULL DEFAULT '1',
  `receber_aviso_novo_torneio_padel` tinyint(1) NOT NULL DEFAULT '1',
  `receber_avaliacoes` tinyint(1) NOT NULL DEFAULT '1',
  `receber_convites` tinyint(1) NOT NULL DEFAULT '1',
  `receber_aviso_jogos_padel_liberados` tinyint(1) NOT NULL DEFAULT '1',
  `created` timestamp NULL DEFAULT NULL,
  `updated` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `FK_notificacoes_configuracoes_usuario_usuarios` (`usuario_id`),
  CONSTRAINT `FK_notificacoes_configuracoes_usuario_usuarios` FOREIGN KEY (`usuario_id`) REFERENCES `usuarios` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=latin1;


ALTER TABLE `notificacoes`
	ADD COLUMN `agendamento_id` INT NULL DEFAULT NULL AFTER `id_one_signal`,
	ADD COLUMN `promocao_id` INT NULL DEFAULT NULL AFTER `agendamento_id`,
	ADD CONSTRAINT `FK_notificacoes_agendamentos` FOREIGN KEY (`agendamento_id`) REFERENCES `agendamentos` (`id`) ON UPDATE CASCADE ON DELETE CASCADE,
	ADD CONSTRAINT `FK_notificacoes_promocoes` FOREIGN KEY (`promocao_id`) REFERENCES `promocoes` (`id`) ON UPDATE CASCADE ON DELETE NO ACTION;



ALTER TABLE `notificacoes_configuracoes_usuario`
	ADD COLUMN `receber_avisos_cancelamentos` TINYINT(1) NOT NULL DEFAULT '1' AFTER `receber_lembretes`;

ALTER TABLE `notificacoes_configuracoes_usuario`
	ADD COLUMN `receber_avisos_cancelamentos` TINYINT(1) NOT NULL DEFAULT '1' AFTER `receber_lembretes`;




valor na tebela de agendamentos
agendamento_data_hora datetime null na tabela de notificações


ALTER TABLE `clientes_clientes`
	ADD COLUMN `created` TIMESTAMP NULL DEFAULT NULL AFTER `id`;



-- Copiando estrutura para tabela buzke_app.notificacoes_motivos
CREATE TABLE IF NOT EXISTS `notificacoes_motivos` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created` timestamp NULL DEFAULT NULL,
  `updated` timestamp NULL DEFAULT NULL,
  `titulo` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `nome` varchar(80) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `permissao` varchar(80) COLLATE utf8mb4_general_ci DEFAULT NULL,
  `grupo` varchar(80) COLLATE utf8mb4_general_ci NOT NULL,
  `titulo_notificacao` varchar(180) COLLATE utf8mb4_general_ci NOT NULL,
  `msg_notificacao` text COLLATE utf8mb4_general_ci NOT NULL,
  PRIMARY KEY (`id`),
  KEY `nome` (`nome`)
) ENGINE=InnoDB AUTO_INCREMENT=13 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Copiando dados para a tabela buzke_app.notificacoes_motivos: ~12 rows (aproximadamente)
INSERT INTO `notificacoes_motivos` (`id`, `created`, `updated`, `titulo`, `nome`, `permissao`, `grupo`, `titulo_notificacao`, `msg_notificacao`) VALUES
	(1, '2024-11-23 15:50:31', '2024-11-23 15:50:32', 'Novo Agendamento criado pela empresa', 'agendamento_empresa', 'receber_avisos_novos_agendamentos', 'agendamentos', 'Novo Agendamento :)', 'Você tem um novo agendamento de {{empresa_nome}} às {{hora_agendamento}} do dia {{dia_agendamento}}. Quadra/Serviço: {{servico_nome}}'),
	(2, '2024-11-23 15:50:33', '2024-11-23 15:50:33', 'Novo agendamento criado pelo usuário', 'agendamento_usuario', NULL, 'agendamentos', 'Novo Agendamento :)', 'Você tem um novo agendamento de {{usuario_nome}} às {{hora_agendamento}} do dia {{dia_agendamento}}. Quadra/Serviço: {{servico_nome}}'),
	(3, '2024-11-23 15:50:36', '2024-11-23 15:50:37', 'Agendamento cancelado pela empresa', 'cancelamento_empresa', 'receber_avisos_cancelamentos', 'cancelamentos', 'Agendamento Cancelado :(', 'A {{empresa_nome}} cancelou seu agendamento de {{dia_agendamento}} das {{hora_agendamento}}'),
	(4, '2024-11-23 15:51:14', '2024-11-23 15:51:15', 'Agendamento cancelado pelo usuário', 'cancelamento_usuario', NULL, 'cancelamento', 'Agendamento Cancelado :(', '{{usuario_nome}} cancelou seu agendamento de {{dia_agendamento}} das {{hora_agendamento}}'),
	(5, '2024-11-23 15:51:28', '2024-11-23 15:51:29', 'Lembrete de agendamento', 'lembrete_agendamento', 'receber_lembretes', 'agendamentos', 'Lembrete de Agendamento', 'Passamos pra lembrar do seu agendamento na {{empresa_nome}} no dia {{dia_agendamento}} às {{hora_agendamento}}. Quadra/Servico: {{servico_nome}}'),
	(6, '2024-11-23 15:52:29', '2024-11-23 15:52:28', 'Lembrete de agendamento de torneio', 'lembrete_agendamento_torneio', 'receber_lembretes', 'agendamentos', 'Lembrete de Jogo de Torneio', 'Passamos pra lembrar do seu jogo no torneio {{torneio_nome}} na {{empresa_nome}} no dia {{dia_agendamento}} às {{hora_agendamento}}. Quadra: {{servico_nome}}'),
	(7, '2024-11-23 15:54:19', '2024-11-23 15:54:21', 'Nova promoção criada', 'nova_promocao', 'receber_promocoes', 'promocoes', 'Nova Promocao', 'A {{empresa_nome}} cadastrou uma nova promoção em seus serviços! Acesse o app e confira agora e aproveite as ofertas especiais.'),
	(8, '2024-11-23 15:56:40', '2024-11-23 15:56:41', 'Novo torneio de padel criado', 'novo_torneio_padel', 'receber_aviso_novo_torneio_padel', 'torneios', 'Novo Torneio de Padel', 'Novo torneio na {{empresa_nome}} do dia {{torneio_data_inicio}} até o dia {{torneio_data_fim}}. Torneio: {{torneio_nome}}'),
	(9, '2024-11-23 15:58:29', '2024-11-23 15:58:30', 'Lembrete para Avaliar', 'lembrete_avaliar', 'receber_avaliacoes', 'avaliacoes', 'Não se esqueça de avaliar!', 'Que tal avaliar o serviço do seu último agendamento? Sua opinião é super importante e ajuda outros usuários a escolherem melhor!'),
	(10, '2024-11-24 16:16:24', '2024-11-24 16:16:25', 'Jogos do torneio librados', 'jogos_torneio_padel_liberados', 'receber_aviso_jogos_padel_liberados', 'torneios', 'Jogos Liberados!', 'Os jogos do torenio {{torneio_nome}} já estão disponíveis.'),
	(11, '2024-11-27 18:51:18', '2024-11-27 18:51:17', 'Convite de jogo recebido', 'convite_jogo', 'receber_convites', 'convites', 'Você recebeu um convite', 'Você recebeu um convite para jogar.'),
	(12, '2024-11-27 18:53:51', '2024-11-27 18:53:51', 'Resposta do convite recebida', 'resposta_convite_jogo', NULL, 'convites', 'Você recebeu a resposta do convite', 'Você recebeu a resposta de um dos convites para jogar.');


  
ALTER TABLE `notificacoes`
	ADD COLUMN `notificacao_motivo_id` INT NULL DEFAULT NULL AFTER `promocao_id`,
	ADD CONSTRAINT `FK_notificacoes_notificacoes_motivos` FOREIGN KEY (`notificacao_motivo_id`) REFERENCES `notificacoes_motivos` (`id`) ON UPDATE CASCADE ON DELETE NO ACTION;


ALTER TABLE `notificacoes_usuarios`
	ADD COLUMN `usuario_id` INT NULL DEFAULT NULL AFTER `updated`,
	ADD CONSTRAINT `FK_notificacoes_usuarios_usuarios` FOREIGN KEY (`usuario_id`) REFERENCES `usuarios` (`id`) ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE `notificacoes`
	CHANGE COLUMN `promocao_id` `registro_id` INT NULL DEFAULT NULL AFTER `agendamento_id`,
	DROP INDEX `FK_notificacoes_promocoes`,
	ADD INDEX `FK_notificacoes_promocoes` (`registro_id`) USING BTREE,
	DROP FOREIGN KEY `FK_notificacoes_promocoes`;


ALTER TABLE `notificacoes`
	DROP INDEX `FK_notificacoes_promocoes`;
  
ALTER TABLE `notificacoes`
	ADD INDEX `registro_id` (`registro_id`);
